<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.
//Patient Profile
int TOTAL_COST;
int TM_COST;
bool has_osa;
bool no_osa;
int ahi; 
bool gotCpapForever = false;
bool therapy_acceptance;
int measuredAHI;
bool hasMeasuredAHI;

// Diagnosis state
bool diagnosed;
bool Dhas_osa;
bool Dno_osa;
bool corDig;
bool corPosDig;
bool startFinalTreatment;
bool endOfTheLine;
bool otherTreatment;

int diagnosisMaximumTime = 0; //TRANS
void diagnose(bool i_has_osa){
    if (!diagnosed){ 

    if (i_has_osa){
        Dhas_osa = true;
    } else {
    endOfTheLine=true;
        Dno_osa = true;
    }
    diagnosed = 1;   
    corDig = Dhas_osa == has_osa;
    corPosDig= has_osa &amp;&amp; corDig;
    }
}

clock alwaysClock;


//Channels
broadcast chan GP_START;
broadcast chan SC_WAIT, SC_START, SC_POS, SC_NEG;

broadcast chan T_T_START;
broadcast chan TREATMENT_START, TREATMENT_POS, TREATMENT_NEG, TREATMENT_FAIL;
broadcast chan T_PHIL3_WAIT, T_PHIL3_START, T_PHIL3_HIGH, T_PHIL3_MID, T_PHIL3_LOW;
broadcast chan T_PSG_WAIT, T_PSG_START, T_PSG_POS, T_PSG_NEG, T_PSG_FAIL;
broadcast chan T_HSAT_WAIT, T_HSAT_START, T_HSAT_POS, T_HSAT_NEG, T_HSAT_FAIL;
broadcast chan T_ODI_WAIT, T_ODI_START, T_ODI_POS, T_ODI_NEG, T_ODI_FAIL;
broadcast chan AM_WAIT, AM_START, AM_POS, AM_NEG, AM_FAIL;
broadcast chan P_START, Q_WAIT, Q_START, Q_POS, Q_NEG, Q_FAIL;
broadcast chan Q_SB_WAIT, Q_SB_START, Q_SB_POS, Q_SB_NEG, Q_SB_FAIL;
broadcast chan Q_BQ_WAIT, Q_BQ_START, Q_BQ_POS, Q_BQ_NEG, Q_BQ_FAIL;
broadcast chan Q_PH_WAIT, Q_PH_START, Q_PH_POS, Q_PH_NEG, Q_PH_FAIL;
broadcast chan Q_PL_WAIT, Q_PL_START, Q_PL_POS, Q_PL_NEG, Q_PL_FAIL;
broadcast chan TEST_WAIT, TEST_START, TEST_POS, TEST_NEG, TEST_FAIL;
broadcast chan DDT_START, DDT_POS, DDT_NEG, DDT_FAIL;
broadcast chan CPAP_WAIT, CPAP_START, CPAP_POS, CPAP_NEG, CPAP_FAIL;
broadcast chan MAD_WAIT, MAD_START, MAD_POS, MAD_NEG, MAD_FAIL;

broadcast chan NOP;






</declaration>
	<template>
		<name>Waiting</name>
		<parameter>broadcast chan &amp;START, broadcast chan &amp;DONE, const int wmin, const int wmax</parameter>
		<declaration>clock w;
int u;</declaration>
		<location id="id0" x="0" y="25">
		</location>
		<location id="id1" x="0" y="-76">
			<urgent/>
		</location>
		<location id="id2" x="204" y="-76">
			<label kind="invariant" x="187" y="-110">w &lt;= u</label>
		</location>
		<location id="id3" x="204" y="25">
			<urgent/>
		</location>
		<init ref="id0"/>
		<transition>
			<source ref="id3"/>
			<target ref="id0"/>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="guard" x="204" y="-59">w &gt;= u</label>
			<label kind="synchronisation" x="204" y="-42">DONE!</label>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="select" x="18" y="-127">c: int[wmin, wmax]</label>
			<label kind="assignment" x="18" y="-76">w=0, u=c</label>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="0" y="-42">START?</label>
		</transition>
	</template>
	<template>
		<name>Timer</name>
		<parameter>bool &amp;fire</parameter>
		<declaration>clock t;
clock total;
clock paused;</declaration>
		<location id="id4" x="0" y="0">
			<label kind="invariant" x="-10" y="17">total'==0&amp;&amp;(t'==(fire&gt;0)*10000)&amp;&amp;( t&lt;1)</label>
		</location>
		<location id="id5" x="0" y="-178">
			<name x="-10" y="-212">Resulted</name>
			<label kind="invariant" x="17" y="-161">paused'==0&amp;&amp;total'==0&amp;&amp;(t'==(!fire&gt;0)*10000)&amp;&amp;( t&lt;1)</label>
		</location>
		<init ref="id4"/>
		<transition>
			<source ref="id5"/>
			<target ref="id4"/>
			<label kind="guard" x="-68" y="-153">t&gt;0</label>
			<label kind="assignment" x="-67" y="-135">t=0</label>
			<nail x="-85" y="-93"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id5"/>
			<label kind="guard" x="17" y="-59">t&gt;0</label>
			<label kind="assignment" x="0" y="-89">t=0,total=alwaysClock</label>
		</transition>
	</template>
	<template>
		<name x="5" y="5">Patient</name>
		<declaration>// Place local declarations here.
const int INCIDENCE = 700; //TRANS
int P_ACCEPTANCE = 750;

int N[4] = {800,200,0,0};
int Y[4] = {0,400,300,300};

</declaration>
		<location id="id6" x="-595" y="-93">
			<committed/>
		</location>
		<location id="id7" x="-391" y="-153">
			<committed/>
		</location>
		<location id="id8" x="-374" y="-42">
			<committed/>
		</location>
		<location id="id9" x="-315" y="-102">
			<committed/>
		</location>
		<location id="id10" x="-187" y="-102">
		</location>
		<branchpoint id="id11" x="-493" y="-93">
		</branchpoint>
		<init ref="id6"/>
		<transition>
			<source ref="id8"/>
			<target ref="id9"/>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id9"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-289" y="-127">GP_START!</label>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id7"/>
			<label kind="assignment" x="-510" y="-178">has_osa := 1</label>
			<label kind="probability" x="-501" y="-153">INCIDENCE</label>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id8"/>
			<label kind="assignment" x="-527" y="-68">no_osa := 1</label>
			<label kind="probability" x="-510" y="-42">1000-INCIDENCE</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id11"/>
		</transition>
	</template>
	<template>
		<name>GPbaseCase</name>
		<location id="id12" x="0" y="0">
		</location>
		<location id="id13" x="119" y="0">
			<urgent/>
		</location>
		<location id="id14" x="246" y="0">
		</location>
		<init ref="id12"/>
		<transition>
			<source ref="id13"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="161" y="-34">SC_WAIT!</label>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id13"/>
			<label kind="synchronisation" x="17" y="-34">GP_START?</label>
		</transition>
	</template>
	<template>
		<name>GPhardFilter</name>
		<location id="id15" x="-42" y="0">
		</location>
		<location id="id16" x="136" y="0">
		</location>
		<location id="id17" x="221" y="-42">
			<committed/>
		</location>
		<location id="id18" x="221" y="51">
		</location>
		<location id="id19" x="323" y="-42">
		</location>
		<location id="id20" x="51" y="0">
			<committed/>
		</location>
		<init ref="id15"/>
		<transition>
			<source ref="id17"/>
			<target ref="id19"/>
			<label kind="synchronisation" x="239" y="-63">SC_WAIT!</label>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id16"/>
			<label kind="synchronisation" x="59" y="-34">Q_START!</label>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id20"/>
			<label kind="synchronisation" x="-34" y="-34">GP_START?</label>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id18"/>
			<label kind="synchronisation" x="136" y="43">Q_NEG?</label>
			<label kind="assignment" x="136" y="68">diagnose(false),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id17"/>
			<label kind="synchronisation" x="144" y="-68">Q_POS?</label>
		</transition>
	</template>
	<template>
		<name>GPhardFilterEitherOr</name>
		<location id="id21" x="-42" y="0">
		</location>
		<location id="id22" x="136" y="0">
		</location>
		<location id="id23" x="340" y="-85">
			<committed/>
		</location>
		<location id="id24" x="51" y="0">
			<committed/>
		</location>
		<location id="id25" x="459" y="-85">
		</location>
		<location id="id26" x="603" y="-212">
			<urgent/>
		</location>
		<location id="id27" x="603" y="51">
			<urgent/>
		</location>
		<location id="id28" x="748" y="51">
		</location>
		<location id="id29" x="756" y="-212">
		</location>
		<init ref="id21"/>
		<transition>
			<source ref="id26"/>
			<target ref="id29"/>
			<label kind="assignment" x="621" y="-212">diagnose(false),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id26"/>
			<label kind="synchronisation" x="578" y="-110">TEST_FAIL?</label>
			<nail x="586" y="-119"/>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id27"/>
			<label kind="synchronisation" x="484" y="-42">TEST_POS?</label>
			<nail x="484" y="-25"/>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id26"/>
			<label kind="synchronisation" x="476" y="-187">TEST_NEG?</label>
		</transition>
		<transition>
			<source ref="id23"/>
			<target ref="id25"/>
			<label kind="synchronisation" x="357" y="-102">TEST_WAIT!</label>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id28"/>
			<label kind="synchronisation" x="612" y="25">SC_START!</label>
		</transition>
		<transition>
			<source ref="id24"/>
			<target ref="id22"/>
			<label kind="synchronisation" x="59" y="-25">Q_START!</label>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id24"/>
			<label kind="synchronisation" x="-34" y="-25">GP_START?</label>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id27"/>
			<label kind="synchronisation" x="153" y="34">Q_POS?</label>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id23"/>
			<label kind="synchronisation" x="154" y="-55">Q_NEG?</label>
		</transition>
	</template>
	<template>
		<name>GPfastTrackTwoLevel</name>
		<location id="id30" x="-42" y="0">
		</location>
		<location id="id31" x="136" y="0">
		</location>
		<location id="id32" x="340" y="-85">
			<committed/>
		</location>
		<location id="id33" x="51" y="0">
			<committed/>
		</location>
		<location id="id34" x="459" y="-85">
		</location>
		<location id="id35" x="603" y="-212">
			<urgent/>
		</location>
		<location id="id36" x="603" y="51">
			<urgent/>
		</location>
		<location id="id37" x="748" y="51">
		</location>
		<location id="id38" x="756" y="-212">
		</location>
		<location id="id39" x="943" y="-212">
		</location>
		<init ref="id30"/>
		<transition>
			<source ref="id38"/>
			<target ref="id39"/>
			<label kind="synchronisation" x="790" y="-229">TREATMENT_FAIL?</label>
			<label kind="assignment" x="798" y="-255">otherTreatment=true,endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id35"/>
			<target ref="id38"/>
			<label kind="synchronisation" x="621" y="-237">TREATMENT_START!</label>
			<label kind="assignment" x="621" y="-212">diagnose(true)</label>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id36"/>
			<label kind="synchronisation" x="535" y="-34">TEST_FAIL?</label>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id36"/>
			<label kind="synchronisation" x="374" y="-34">TEST_NEG?</label>
			<nail x="467" y="8"/>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id35"/>
			<label kind="synchronisation" x="476" y="-187">TEST_POS?</label>
		</transition>
		<transition>
			<source ref="id32"/>
			<target ref="id34"/>
			<label kind="synchronisation" x="357" y="-102">TEST_WAIT!</label>
		</transition>
		<transition>
			<source ref="id36"/>
			<target ref="id37"/>
			<label kind="synchronisation" x="612" y="25">SC_START!</label>
		</transition>
		<transition>
			<source ref="id33"/>
			<target ref="id31"/>
			<label kind="synchronisation" x="59" y="-25">Q_START!</label>
		</transition>
		<transition>
			<source ref="id30"/>
			<target ref="id33"/>
			<label kind="synchronisation" x="-34" y="-25">GP_START?</label>
		</transition>
		<transition>
			<source ref="id31"/>
			<target ref="id36"/>
			<label kind="synchronisation" x="153" y="34">Q_NEG?</label>
		</transition>
		<transition>
			<source ref="id31"/>
			<target ref="id32"/>
			<label kind="synchronisation" x="154" y="-55">Q_POS?</label>
		</transition>
	</template>
	<template>
		<name>GPfastTrackThreeLevel</name>
		<location id="id40" x="-391" y="-17">
		</location>
		<location id="id41" x="-272" y="-17">
			<committed/>
		</location>
		<location id="id42" x="-187" y="-17">
		</location>
		<location id="id43" x="-187" y="-127">
			<committed/>
		</location>
		<location id="id44" x="25" y="-17">
			<committed/>
		</location>
		<location id="id45" x="-187" y="85">
			<name x="-197" y="51">H</name>
		</location>
		<location id="id46" x="170" y="-17">
		</location>
		<location id="id47" x="25" y="-127">
		</location>
		<location id="id48" x="25" y="-221">
			<urgent/>
		</location>
		<location id="id49" x="170" y="-221">
		</location>
		<init ref="id40"/>
		<transition>
			<source ref="id48"/>
			<target ref="id49"/>
			<label kind="synchronisation" x="17" y="-255">TREATMENT_START!</label>
			<label kind="assignment" x="43" y="-221">endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="-59" y="-76">TEST_FAIL?</label>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="68" y="-110">TEST_NEG?</label>
			<nail x="68" y="-76"/>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id48"/>
			<label kind="synchronisation" x="-59" y="-212">TEST_POS?</label>
			<label kind="assignment" x="-85" y="-195">diagnose(true)</label>
		</transition>
		<transition>
			<source ref="id43"/>
			<target ref="id47"/>
			<label kind="synchronisation" x="-136" y="-144">TEST_START!</label>
		</transition>
		<transition>
			<source ref="id44"/>
			<target ref="id46"/>
			<label kind="synchronisation" x="42" y="-8">SC_WAIT!</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id45"/>
			<label kind="synchronisation" x="-187" y="42">T_PHIL3_LOW?</label>
			<label kind="assignment" x="-187" y="59">diagnose(false),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="-136" y="-34">T_PHIL3_MID?</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id43"/>
			<label kind="synchronisation" x="-297" y="-110">T_PHIL3_HIGH?</label>
		</transition>
		<transition>
			<source ref="id41"/>
			<target ref="id42"/>
			<label kind="synchronisation" x="-289" y="-8">T_PHIL3_START!</label>
		</transition>
		<transition>
			<source ref="id40"/>
			<target ref="id41"/>
			<label kind="synchronisation" x="-374" y="-34">GP_START?</label>
		</transition>
	</template>
	<template>
		<name>GPfastTrackEitherOr</name>
		<location id="id50" x="-42" y="0">
		</location>
		<location id="id51" x="136" y="0">
		</location>
		<location id="id52" x="340" y="-85">
			<committed/>
		</location>
		<location id="id53" x="51" y="0">
			<committed/>
		</location>
		<location id="id54" x="459" y="-85">
		</location>
		<location id="id55" x="603" y="-212">
			<urgent/>
		</location>
		<location id="id56" x="603" y="51">
			<urgent/>
		</location>
		<location id="id57" x="748" y="51">
		</location>
		<location id="id58" x="756" y="-212">
		</location>
		<location id="id59" x="212" y="212">
			<committed/>
		</location>
		<location id="id60" x="331" y="212">
		</location>
		<location id="id61" x="544" y="340">
			<urgent/>
		</location>
		<location id="id62" x="697" y="340">
		</location>
		<location id="id63" x="1019" y="340">
		</location>
		<location id="id64" x="918" y="340">
			<committed/>
		</location>
		<location id="id65" x="1172" y="340">
		</location>
		<init ref="id50"/>
		<transition>
			<source ref="id55"/>
			<target ref="id58"/>
			<label kind="assignment" x="621" y="-212">diagnose(false),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="578" y="-110">TEST_FAIL?</label>
			<nail x="586" y="-119"/>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id56"/>
			<label kind="synchronisation" x="484" y="-42">TEST_POS?</label>
			<nail x="484" y="-25"/>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="476" y="-187">TEST_NEG?</label>
		</transition>
		<transition>
			<source ref="id52"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="357" y="-102">TEST_WAIT!</label>
		</transition>
		<transition>
			<source ref="id56"/>
			<target ref="id57"/>
			<label kind="synchronisation" x="612" y="25">SC_START!</label>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id51"/>
			<label kind="synchronisation" x="59" y="-25">Q_START!</label>
		</transition>
		<transition>
			<source ref="id50"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="-34" y="-25">GP_START?</label>
		</transition>
		<transition>
			<source ref="id51"/>
			<target ref="id59"/>
			<label kind="synchronisation" x="153" y="34">Q_POS?</label>
		</transition>
		<transition>
			<source ref="id51"/>
			<target ref="id52"/>
			<label kind="synchronisation" x="154" y="-55">Q_NEG?</label>
		</transition>
		<transition>
			<source ref="id60"/>
			<target ref="id56"/>
			<label kind="synchronisation" x="450" y="187">TEST_FAIL?</label>
			<nail x="458" y="178"/>
		</transition>
		<transition>
			<source ref="id60"/>
			<target ref="id61"/>
			<label kind="synchronisation" x="356" y="255">TEST_POS?</label>
			<nail x="356" y="272"/>
		</transition>
		<transition>
			<source ref="id60"/>
			<target ref="id56"/>
			<label kind="synchronisation" x="348" y="110">TEST_NEG?</label>
		</transition>
		<transition>
			<source ref="id59"/>
			<target ref="id60"/>
			<label kind="synchronisation" x="229" y="195">TEST_WAIT!</label>
		</transition>
		<transition>
			<source ref="id62"/>
			<target ref="id64"/>
			<label kind="synchronisation" x="731" y="323">TREATMENT_FAIL?</label>
		</transition>
		<transition>
			<source ref="id61"/>
			<target ref="id62"/>
			<label kind="synchronisation" x="562" y="315">TREATMENT_START!</label>
			<label kind="assignment" x="562" y="340">diagnose(true)</label>
		</transition>
		<transition>
			<source ref="id63"/>
			<target ref="id65"/>
			<label kind="synchronisation" x="1037" y="323">SC_POS?</label>
			<label kind="assignment" x="1037" y="340">otherTreatment=true,endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id64"/>
			<target ref="id63"/>
			<label kind="synchronisation" x="934" y="324">SC_WAIT!</label>
		</transition>
	</template>
	<template>
		<name>GPultraInexpensive</name>
		<location id="id66" x="517" y="8">
		</location>
		<location id="id67" x="-620" y="8">
		</location>
		<location id="id68" x="68" y="8">
			<committed/>
		</location>
		<location id="id69" x="416" y="8">
			<committed/>
		</location>
		<location id="id70" x="153" y="8">
		</location>
		<location id="id71" x="272" y="-85">
		</location>
		<location id="id72" x="670" y="8">
		</location>
		<location id="id73" x="-187" y="8">
			<committed/>
		</location>
		<location id="id74" x="-102" y="8">
		</location>
		<location id="id75" x="-17" y="59">
		</location>
		<location id="id76" x="-467" y="8">
			<committed/>
		</location>
		<location id="id77" x="-382" y="8">
		</location>
		<location id="id78" x="-297" y="59">
		</location>
		<init ref="id67"/>
		<transition>
			<source ref="id66"/>
			<target ref="id72"/>
			<label kind="synchronisation" x="535" y="-9">SC_POS?</label>
			<label kind="assignment" x="535" y="8">otherTreatment=true,endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id69"/>
			<target ref="id66"/>
			<label kind="synchronisation" x="432" y="-8">SC_WAIT!</label>
		</transition>
		<transition>
			<source ref="id67"/>
			<target ref="id76"/>
			<label kind="synchronisation" x="-602" y="-9">GP_START?</label>
		</transition>
		<transition>
			<source ref="id70"/>
			<target ref="id69"/>
			<label kind="synchronisation" x="161" y="34">CPAP_NEG?</label>
			<nail x="272" y="51"/>
		</transition>
		<transition>
			<source ref="id70"/>
			<target ref="id71"/>
			<label kind="synchronisation" x="246" y="-59">CPAP_POS?</label>
			<label kind="assignment" x="229" y="-42">endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id68"/>
			<target ref="id70"/>
			<label kind="synchronisation" x="42" y="-34">TREATMENT_START!</label>
		</transition>
		<transition>
			<source ref="id70"/>
			<target ref="id69"/>
			<label kind="synchronisation" x="178" y="-8">CPAP_FAIL?</label>
		</transition>
		<transition>
			<source ref="id73"/>
			<target ref="id74"/>
			<label kind="synchronisation" x="-179" y="-26">TEST_WAIT!</label>
		</transition>
		<transition>
			<source ref="id74"/>
			<target ref="id75"/>
			<label kind="synchronisation" x="-102" y="51">TEST_NEG?</label>
			<label kind="assignment" x="-170" y="68">diagnose(false),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id74"/>
			<target ref="id68"/>
			<label kind="synchronisation" x="-68" y="-17">TEST_POS?</label>
			<label kind="assignment" x="-84" y="8">diagnose(true)</label>
		</transition>
		<transition>
			<source ref="id76"/>
			<target ref="id77"/>
			<label kind="synchronisation" x="-459" y="-26">Q_START!</label>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id78"/>
			<label kind="synchronisation" x="-382" y="51">Q_NEG?</label>
			<label kind="assignment" x="-493" y="102">diagnose(false),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id73"/>
			<label kind="synchronisation" x="-382" y="17">Q_POS?</label>
		</transition>
	</template>
	<template>
		<name>GPcpapFirst</name>
		<location id="id79" x="-391" y="-17">
		</location>
		<location id="id80" x="-272" y="-17">
			<committed/>
		</location>
		<location id="id81" x="-42" y="-17">
			<committed/>
		</location>
		<location id="id82" x="-136" y="-17">
		</location>
		<location id="id83" x="-42" y="-144">
		</location>
		<location id="id84" x="144" y="-17">
		</location>
		<location id="id85" x="272" y="-17">
		</location>
		<init ref="id79"/>
		<transition>
			<source ref="id82"/>
			<target ref="id81"/>
			<label kind="synchronisation" x="-127" y="17">CPAP_NEG?</label>
		</transition>
		<transition>
			<source ref="id82"/>
			<target ref="id83"/>
			<label kind="synchronisation" x="-161" y="-127">CPAP_POS?</label>
			<label kind="assignment" x="-178" y="-102">diagnose(true),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id80"/>
			<target ref="id82"/>
			<label kind="synchronisation" x="-272" y="-68">TREATMENT_START!</label>
		</transition>
		<transition>
			<source ref="id82"/>
			<target ref="id81"/>
			<label kind="synchronisation" x="-127" y="-8">CPAP_FAIL?</label>
		</transition>
		<transition>
			<source ref="id81"/>
			<target ref="id84"/>
			<label kind="synchronisation" x="25" y="-17">SC_WAIT!</label>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id80"/>
			<label kind="synchronisation" x="-374" y="-34">GP_START?</label>
		</transition>
		<transition>
			<source ref="id84"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="162" y="-34">SC_POS?</label>
			<label kind="assignment" x="162" y="-17">otherTreatment=true,endOfTheLine=true</label>
		</transition>
	</template>
	<template>
		<name>GPqThenCpap</name>
		<location id="id86" x="-59" y="195">
		</location>
		<location id="id87" x="119" y="195">
		</location>
		<location id="id88" x="280" y="195">
		</location>
		<location id="id89" x="34" y="195">
			<committed/>
		</location>
		<location id="id90" x="119" y="-68">
			<committed/>
		</location>
		<location id="id91" x="280" y="-68">
		</location>
		<location id="id92" x="425" y="-170">
		</location>
		<location id="id93" x="280" y="-247">
		</location>
		<location id="id94" x="382" y="127">
		</location>
		<location id="id95" x="187" y="195">
			<committed/>
		</location>
		<location id="id96" x="918" y="314">
			<committed/>
		</location>
		<location id="id97" x="1113" y="314">
		</location>
		<location id="id98" x="467" y="263">
		</location>
		<location id="id99" x="612" y="161">
		</location>
		<location id="id100" x="467" y="84">
		</location>
		<location id="id101" x="586" y="0">
		</location>
		<location id="id102" x="773" y="-26">
		</location>
		<location id="id103" x="493" y="0">
			<committed/>
		</location>
		<location id="id104" x="773" y="68">
		</location>
		<init ref="id86"/>
		<transition>
			<source ref="id88"/>
			<target ref="id94"/>
			<label kind="synchronisation" x="272" y="119">SC_NEG?</label>
			<label kind="assignment" x="255" y="136">diagnose(false)</label>
		</transition>
		<transition>
			<source ref="id95"/>
			<target ref="id88"/>
			<label kind="synchronisation" x="204" y="170">SC_WAIT!</label>
		</transition>
		<transition>
			<source ref="id89"/>
			<target ref="id87"/>
			<label kind="synchronisation" x="51" y="170">Q_START!</label>
		</transition>
		<transition>
			<source ref="id86"/>
			<target ref="id89"/>
			<label kind="synchronisation" x="-51" y="170">GP_START?</label>
		</transition>
		<transition>
			<source ref="id87"/>
			<target ref="id95"/>
			<label kind="synchronisation" x="127" y="220">Q_NEG?</label>
		</transition>
		<transition>
			<source ref="id87"/>
			<target ref="id90"/>
			<label kind="synchronisation" x="51" y="-43">Q_POS?</label>
		</transition>
		<transition>
			<source ref="id91"/>
			<target ref="id103"/>
			<label kind="synchronisation" x="374" y="-68">CPAP_NEG?</label>
			<nail x="374" y="-60"/>
		</transition>
		<transition>
			<source ref="id91"/>
			<target ref="id93"/>
			<label kind="synchronisation" x="289" y="-221">CPAP_POS?</label>
			<label kind="assignment" x="289" y="-204">diagnose(true),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id90"/>
			<target ref="id91"/>
			<label kind="synchronisation" x="119" y="-102">TREATMENT_START!</label>
		</transition>
		<transition>
			<source ref="id91"/>
			<target ref="id103"/>
			<label kind="synchronisation" x="306" y="-9">CPAP_FAIL?</label>
			<nail x="357" y="-17"/>
		</transition>
		<transition>
			<source ref="id88"/>
			<target ref="id98"/>
			<label kind="synchronisation" x="323" y="255">SC_POS?</label>
			<label kind="assignment" x="323" y="268">diagnose(true)</label>
		</transition>
		<transition>
			<source ref="id96"/>
			<target ref="id97"/>
			<label kind="assignment" x="934" y="264">otherTreatment=true,endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id98"/>
			<target ref="id99"/>
			<label kind="synchronisation" x="612" y="169">CPAP_NEG?</label>
			<label kind="assignment" x="595" y="186">diagnose(false)</label>
		</transition>
		<transition>
			<source ref="id98"/>
			<target ref="id100"/>
			<label kind="synchronisation" x="484" y="135">CPAP_POS?</label>
			<label kind="assignment" x="484" y="152">diagnose(true)</label>
		</transition>
		<transition>
			<source ref="id98"/>
			<target ref="id96"/>
			<label kind="synchronisation" x="518" y="237">CPAP_FAIL?</label>
		</transition>
		<transition>
			<source ref="id101"/>
			<target ref="id102"/>
			<label kind="synchronisation" x="697" y="-77">SC_NEG?</label>
			<label kind="assignment" x="680" y="-60">diagnose(false),endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id103"/>
			<target ref="id101"/>
			<label kind="synchronisation" x="510" y="-25">SC_WAIT!</label>
		</transition>
		<transition>
			<source ref="id101"/>
			<target ref="id104"/>
			<label kind="synchronisation" x="629" y="60">SC_POS?</label>
			<label kind="assignment" x="629" y="73">diagnose(true), otherTreatment=true,endOfTheLine=true</label>
		</transition>
	</template>
	<template>
		<name>SleepCentre</name>
		<parameter>broadcast chan &amp;POS</parameter>
		<declaration>// SOMNO1 statistically decides whether a patient has OSA or not, purely based on whether they have symptoms.

int base_costs = 300;

int T[2] = {1000,0};
int F[2] = {700,300};

int NOO = 100;

int PSGodds = 1000; //trans</declaration>
		<location id="id105" x="-1029" y="-68">
		</location>
		<location id="id106" x="-654" y="-144">
			<urgent/>
		</location>
		<location id="id107" x="-408" y="17">
			<urgent/>
		</location>
		<location id="id108" x="-272" y="-136">
			<urgent/>
		</location>
		<location id="id109" x="-315" y="17">
			<urgent/>
		</location>
		<location id="id110" x="-952" y="-68">
			<urgent/>
		</location>
		<location id="id111" x="-595" y="17">
			<urgent/>
		</location>
		<location id="id112" x="-408" y="-136">
		</location>
		<location id="id113" x="-137" y="17">
		</location>
		<location id="id114" x="-136" y="-136">
		</location>
		<location id="id115" x="-748" y="-68">
		</location>
		<location id="id116" x="-544" y="-204">
			<committed/>
		</location>
		<location id="id117" x="-544" y="-85">
			<committed/>
		</location>
		<location id="id118" x="-408" y="-263">
			<committed/>
		</location>
		<branchpoint id="id119" x="-595" y="-145">
		</branchpoint>
		<init ref="id105"/>
		<transition>
			<source ref="id118"/>
			<target ref="id116"/>
			<nail x="-527" y="-263"/>
		</transition>
		<transition>
			<source ref="id112"/>
			<target ref="id118"/>
			<label kind="synchronisation" x="-408" y="-238">TEST_FAIL?</label>
		</transition>
		<transition>
			<source ref="id117"/>
			<target ref="id112"/>
			<label kind="synchronisation" x="-518" y="-93">T_HSAT_WAIT!</label>
		</transition>
		<transition>
			<source ref="id119"/>
			<target ref="id117"/>
			<label kind="probability" x="-671" y="-110">1000-PSGodds</label>
		</transition>
		<transition>
			<source ref="id116"/>
			<target ref="id112"/>
			<label kind="synchronisation" x="-518" y="-204">T_PSG_WAIT!</label>
		</transition>
		<transition>
			<source ref="id119"/>
			<target ref="id116"/>
			<label kind="probability" x="-629" y="-187">PSGodds</label>
		</transition>
		<transition>
			<source ref="id106"/>
			<target ref="id119"/>
		</transition>
		<transition>
			<source ref="id115"/>
			<target ref="id111"/>
			<label kind="synchronisation" x="-730" y="-17">AM_NEG?</label>
		</transition>
		<transition>
			<source ref="id115"/>
			<target ref="id106"/>
			<label kind="synchronisation" x="-765" y="-127">AM_POS?</label>
		</transition>
		<transition>
			<source ref="id110"/>
			<target ref="id115"/>
			<label kind="synchronisation" x="-926" y="-85">AM_START!</label>
		</transition>
		<transition>
			<source ref="id112"/>
			<target ref="id107"/>
			<label kind="synchronisation" x="-408" y="-51">TEST_NEG?</label>
		</transition>
		<transition>
			<source ref="id112"/>
			<target ref="id108"/>
			<label kind="synchronisation" x="-374" y="-161">TEST_POS?</label>
		</transition>
		<transition>
			<source ref="id111"/>
			<target ref="id107"/>
		</transition>
		<transition>
			<source ref="id108"/>
			<target ref="id114"/>
			<label kind="synchronisation" x="-230" y="-161">SC_POS!</label>
		</transition>
		<transition>
			<source ref="id105"/>
			<target ref="id110"/>
			<label kind="synchronisation" x="-1028" y="-102">SC_START?</label>
			<label kind="assignment" x="-1054" y="-51">COST = COST + price</label>
		</transition>
		<transition>
			<source ref="id107"/>
			<target ref="id109"/>
			<label kind="synchronisation" x="-400" y="-8">SC_NEG!</label>
		</transition>
		<transition>
			<source ref="id109"/>
			<target ref="id113"/>
			<label kind="assignment" x="-280" y="-8">diagnose(false)</label>
		</transition>
	</template>
	<template>
		<name>TestPSG</name>
		<parameter>broadcast chan &amp;START</parameter>
		<declaration>int tabl[4] = {0, 1000, 1000, 1000};
int pos = 0;
int my_cost = 1250;
int wrongOdds=50;
int get_P(){
    return tabl[has_osa];
}</declaration>
		<location id="id120" x="-76" y="221">
		</location>
		<location id="id121" x="-76" y="-59">
			<urgent/>
		</location>
		<location id="id122" x="-127" y="-204">
			<urgent/>
		</location>
		<location id="id123" x="-25" y="-204">
			<urgent/>
		</location>
		<location id="id124" x="-76" y="119">
			<urgent/>
		</location>
		<location id="id125" x="-297" y="17">
			<urgent/>
		</location>
		<branchpoint id="id126" x="-76" y="-119">
		</branchpoint>
		<branchpoint id="id127" x="-76" y="17">
		</branchpoint>
		<init ref="id120"/>
		<transition>
			<source ref="id127"/>
			<target ref="id121"/>
			<label kind="probability" x="-72" y="-4">1000-wrongOdds</label>
		</transition>
		<transition>
			<source ref="id122"/>
			<target ref="id120"/>
			<label kind="synchronisation" x="-229" y="-221">TEST_POS!</label>
			<nail x="-187" y="-204"/>
			<nail x="-187" y="187"/>
		</transition>
		<transition>
			<source ref="id123"/>
			<target ref="id120"/>
			<label kind="synchronisation" x="-7" y="-221">TEST_NEG!</label>
			<nail x="93" y="-204"/>
			<nail x="85" y="221"/>
		</transition>
		<transition>
			<source ref="id126"/>
			<target ref="id123"/>
			<label kind="probability" x="-50" y="-144">1000-pos</label>
		</transition>
		<transition>
			<source ref="id126"/>
			<target ref="id122"/>
			<label kind="probability" x="-127" y="-144">pos</label>
		</transition>
		<transition>
			<source ref="id121"/>
			<target ref="id126"/>
		</transition>
		<transition>
			<source ref="id120"/>
			<target ref="id124"/>
			<label kind="synchronisation" x="-68" y="187">START?</label>
			<label kind="assignment" x="-68" y="153">pos = get_P(),
TOTAL_COST = TOTAL_COST + my_cost</label>
		</transition>
		<transition>
			<source ref="id127"/>
			<target ref="id125"/>
			<label kind="probability" x="-279" y="34">wrongOdds</label>
		</transition>
		<transition>
			<source ref="id124"/>
			<target ref="id127"/>
		</transition>
		<transition>
			<source ref="id125"/>
			<target ref="id120"/>
			<label kind="synchronisation" x="-279" y="204">TEST_FAIL!</label>
			<nail x="-297" y="221"/>
		</transition>
	</template>
	<template>
		<name>TestHSAT</name>
		<parameter>broadcast chan &amp;START</parameter>
		<declaration>int my_cost = 650;
bool result;
int wrongOdds=50;
int gtv(){
    if (has_osa){
    return 1000;
    }
    return 50;
}

void setResult(){
    int a = fint(random(1000.0));
    if (a &lt; gtv()){
        result = true;
    } else { 
        result = false;
    }

}</declaration>
		<location id="id128" x="0" y="0">
		</location>
		<location id="id129" x="0" y="-102">
			<urgent/>
		</location>
		<location id="id130" x="0" y="-289">
			<urgent/>
		</location>
		<location id="id131" x="-221" y="-204">
			<urgent/>
		</location>
		<location id="id132" x="-127" y="-399">
			<urgent/>
		</location>
		<location id="id133" x="136" y="-391">
			<urgent/>
		</location>
		<branchpoint id="id134" x="0" y="-204">
		</branchpoint>
		<init ref="id128"/>
		<transition>
			<source ref="id134"/>
			<target ref="id131"/>
			<label kind="probability" x="-203" y="-187">wrongOdds</label>
		</transition>
		<transition>
			<source ref="id134"/>
			<target ref="id130"/>
			<label kind="probability" x="0" y="-229">1000-wrongOdds</label>
		</transition>
		<transition>
			<source ref="id129"/>
			<target ref="id134"/>
		</transition>
		<transition>
			<source ref="id132"/>
			<target ref="id128"/>
			<label kind="synchronisation" x="-119" y="-306">TEST_NEG!</label>
			<nail x="-127" y="0"/>
		</transition>
		<transition>
			<source ref="id133"/>
			<target ref="id128"/>
			<label kind="synchronisation" x="34" y="-306">TEST_POS!</label>
			<nail x="136" y="0"/>
		</transition>
		<transition>
			<source ref="id130"/>
			<target ref="id133"/>
			<label kind="guard" x="18" y="-374">result</label>
		</transition>
		<transition>
			<source ref="id130"/>
			<target ref="id132"/>
			<label kind="guard" x="-85" y="-382">!result</label>
		</transition>
		<transition>
			<source ref="id131"/>
			<target ref="id128"/>
			<label kind="synchronisation" x="-203" y="-17">TEST_FAIL!</label>
			<nail x="-221" y="0"/>
		</transition>
		<transition>
			<source ref="id128"/>
			<target ref="id129"/>
			<label kind="synchronisation" x="0" y="-68">START?</label>
			<label kind="assignment" x="0" y="-51">setResult(), TOTAL_COST = TOTAL_COST + my_cost</label>
		</transition>
	</template>
	<template>
		<name>TestODI</name>
		<parameter>broadcast chan &amp;START</parameter>
		<declaration>int FP = 500;
int TP = 1000; //trans
int cost = 120;

</declaration>
		<location id="id135" x="-76" y="34">
		</location>
		<location id="id136" x="-76" y="-59">
			<urgent/>
		</location>
		<location id="id137" x="-144" y="-204">
			<urgent/>
		</location>
		<location id="id138" x="-17" y="-204">
			<urgent/>
		</location>
		<location id="id139" x="-17" y="-102">
			<urgent/>
		</location>
		<location id="id140" x="-144" y="-102">
			<urgent/>
		</location>
		<branchpoint id="id141" x="-144" y="-153">
		</branchpoint>
		<branchpoint id="id142" x="-17" y="-144">
		</branchpoint>
		<init ref="id135"/>
		<transition>
			<source ref="id141"/>
			<target ref="id138"/>
			<label kind="probability" x="-102" y="-221">1000-FP</label>
		</transition>
		<transition>
			<source ref="id141"/>
			<target ref="id137"/>
			<label kind="probability" x="-170" y="-178">FP</label>
		</transition>
		<transition>
			<source ref="id140"/>
			<target ref="id141"/>
		</transition>
		<transition>
			<source ref="id136"/>
			<target ref="id139"/>
			<label kind="guard" x="-42" y="-76">has_osa</label>
		</transition>
		<transition>
			<source ref="id136"/>
			<target ref="id140"/>
			<label kind="guard" x="-161" y="-68">!has_osa</label>
		</transition>
		<transition>
			<source ref="id137"/>
			<target ref="id135"/>
			<label kind="synchronisation" x="-229" y="-221">TEST_POS!</label>
			<nail x="-187" y="-204"/>
			<nail x="-187" y="34"/>
		</transition>
		<transition>
			<source ref="id138"/>
			<target ref="id135"/>
			<label kind="synchronisation" x="17" y="-229">TEST_NEG!</label>
			<nail x="93" y="-204"/>
			<nail x="93" y="34"/>
		</transition>
		<transition>
			<source ref="id142"/>
			<target ref="id138"/>
			<label kind="probability" x="0" y="-178">1000-TP</label>
		</transition>
		<transition>
			<source ref="id142"/>
			<target ref="id137"/>
			<label kind="probability" x="-68" y="-153">TP</label>
		</transition>
		<transition>
			<source ref="id139"/>
			<target ref="id142"/>
		</transition>
		<transition>
			<source ref="id135"/>
			<target ref="id136"/>
			<label kind="synchronisation" x="-68" y="-25">START?</label>
			<label kind="assignment" x="-76" y="-12">TOTAL_COST = TOTAL_COST + cost</label>
		</transition>
	</template>
	<template>
		<name>Anamnesis</name>
		<declaration>const int FP = 333; //trans
const int TP = 1000; //trans
int tabl[2] = {FP , TP}; // FP, TP
int cost = 30;
int pos;
int get_P(){
    return tabl[has_osa];
}</declaration>
		<location id="id143" x="-76" y="34">
		</location>
		<location id="id144" x="-76" y="-59">
			<urgent/>
		</location>
		<location id="id145" x="-127" y="-204">
			<urgent/>
		</location>
		<location id="id146" x="-25" y="-204">
			<urgent/>
		</location>
		<branchpoint id="id147" x="-76" y="-119">
		</branchpoint>
		<init ref="id143"/>
		<transition>
			<source ref="id145"/>
			<target ref="id143"/>
			<label kind="synchronisation" x="-229" y="-221">AM_POS!</label>
			<nail x="-187" y="-204"/>
			<nail x="-187" y="34"/>
		</transition>
		<transition>
			<source ref="id146"/>
			<target ref="id143"/>
			<label kind="synchronisation" x="-7" y="-221">AM_NEG!</label>
			<nail x="93" y="-204"/>
			<nail x="93" y="34"/>
		</transition>
		<transition>
			<source ref="id147"/>
			<target ref="id146"/>
			<label kind="probability" x="-50" y="-144">1000-pos</label>
		</transition>
		<transition>
			<source ref="id147"/>
			<target ref="id145"/>
			<label kind="probability" x="-127" y="-144">pos</label>
		</transition>
		<transition>
			<source ref="id144"/>
			<target ref="id147"/>
		</transition>
		<transition>
			<source ref="id143"/>
			<target ref="id144"/>
			<label kind="synchronisation" x="-76" y="-29">AM_START?</label>
			<label kind="assignment" x="-76" y="-12">pos = get_P(), TOTAL_COST = TOTAL_COST + cost</label>
		</transition>
	</template>
	<template>
		<name>QPhilips3</name>
		<declaration>int costs = 0;

int T[3] =  {500, 300, 200};
int F[3] = {100,300,600};
</declaration>
		<location id="id148" x="-204" y="-467">
			<committed/>
		</location>
		<location id="id149" x="0" y="0">
		</location>
		<location id="id150" x="0" y="-467">
			<committed/>
		</location>
		<location id="id151" x="204" y="-467">
			<committed/>
		</location>
		<location id="id152" x="85" y="-306">
			<committed/>
		</location>
		<location id="id153" x="-85" y="-314">
			<committed/>
		</location>
		<location id="id154" x="0" y="-204">
			<committed/>
		</location>
		<location id="id155" x="0" y="-102">
			<committed/>
		</location>
		<branchpoint id="id156" x="85" y="-399">
		</branchpoint>
		<branchpoint id="id157" x="-85" y="-399">
		</branchpoint>
		<init ref="id149"/>
		<transition>
			<source ref="id148"/>
			<target ref="id149"/>
			<label kind="synchronisation" x="-186" y="-17">T_PHIL3_HIGH!</label>
			<nail x="-204" y="0"/>
		</transition>
		<transition>
			<source ref="id150"/>
			<target ref="id149"/>
			<label kind="synchronisation" x="18" y="-569">T_PHIL3_MID!</label>
			<nail x="0" y="-552"/>
			<nail x="331" y="-552"/>
			<nail x="331" y="0"/>
		</transition>
		<transition>
			<source ref="id151"/>
			<target ref="id149"/>
			<label kind="synchronisation" x="204" y="-306">T_PHIL3_LOW!</label>
			<nail x="204" y="0"/>
		</transition>
		<transition>
			<source ref="id152"/>
			<target ref="id156"/>
			<nail x="85" y="-391"/>
		</transition>
		<transition>
			<source ref="id156"/>
			<target ref="id151"/>
			<label kind="probability" x="110" y="-416">F[2]</label>
		</transition>
		<transition>
			<source ref="id156"/>
			<target ref="id148"/>
			<label kind="probability" x="-144" y="-467">F[0]</label>
		</transition>
		<transition>
			<source ref="id156"/>
			<target ref="id150"/>
			<label kind="probability" x="17" y="-408">F[1]</label>
		</transition>
		<transition>
			<source ref="id157"/>
			<target ref="id151"/>
			<label kind="probability" x="-51" y="-408">T[2]</label>
		</transition>
		<transition>
			<source ref="id157"/>
			<target ref="id150"/>
			<label kind="probability" x="-68" y="-459">T[1]</label>
		</transition>
		<transition>
			<source ref="id157"/>
			<target ref="id148"/>
			<label kind="probability" x="-161" y="-416">T[0]</label>
		</transition>
		<transition>
			<source ref="id153"/>
			<target ref="id157"/>
		</transition>
		<transition>
			<source ref="id154"/>
			<target ref="id152"/>
			<label kind="guard" x="51" y="-272">no_osa</label>
		</transition>
		<transition>
			<source ref="id154"/>
			<target ref="id153"/>
			<label kind="guard" x="-127" y="-272">has_osa</label>
		</transition>
		<transition>
			<source ref="id155"/>
			<target ref="id154"/>
			<label kind="assignment" x="0" y="-153">TOTAL_COST = TOTAL_COST +  costs</label>
		</transition>
		<transition>
			<source ref="id149"/>
			<target ref="id155"/>
			<label kind="synchronisation" x="0" y="-68">T_PHIL3_START?</label>
		</transition>
	</template>
	<template>
		<name>QPhilHigh</name>
		<parameter>broadcast chan &amp;START</parameter>
		<location id="id158" x="-153" y="-255">
			<committed/>
		</location>
		<location id="id159" x="-671" y="-238">
		</location>
		<location id="id160" x="-323" y="-340">
			<committed/>
		</location>
		<location id="id161" x="-314" y="-153">
			<committed/>
		</location>
		<location id="id162" x="-450" y="-238">
		</location>
		<location id="id163" x="-561" y="-238">
			<committed/>
		</location>
		<init ref="id159"/>
		<transition>
			<source ref="id158"/>
			<target ref="id159"/>
			<nail x="-153" y="-280"/>
			<nail x="-153" y="-416"/>
			<nail x="-671" y="-416"/>
		</transition>
		<transition>
			<source ref="id160"/>
			<target ref="id158"/>
			<label kind="synchronisation" x="-305" y="-314">Q_POS!</label>
		</transition>
		<transition>
			<source ref="id161"/>
			<target ref="id158"/>
			<label kind="synchronisation" x="-296" y="-221">Q_NEG!</label>
		</transition>
		<transition>
			<source ref="id162"/>
			<target ref="id161"/>
			<label kind="synchronisation" x="-390" y="-170">T_PHIL3_LOW?</label>
			<nail x="-408" y="-153"/>
		</transition>
		<transition>
			<source ref="id162"/>
			<target ref="id161"/>
			<label kind="synchronisation" x="-432" y="-212">T_PHIL3_MID?</label>
		</transition>
		<transition>
			<source ref="id162"/>
			<target ref="id160"/>
			<label kind="synchronisation" x="-432" y="-306">T_PHIL3_HIGH?</label>
		</transition>
		<transition>
			<source ref="id163"/>
			<target ref="id162"/>
			<label kind="synchronisation" x="-543" y="-255">T_PHIL3_START!</label>
		</transition>
		<transition>
			<source ref="id159"/>
			<target ref="id163"/>
			<label kind="synchronisation" x="-653" y="-255">START?</label>
		</transition>
	</template>
	<template>
		<name>QPhilLow</name>
		<parameter>broadcast chan &amp;START</parameter>
		<location id="id164" x="-153" y="-255">
			<committed/>
		</location>
		<location id="id165" x="-671" y="-238">
		</location>
		<location id="id166" x="-323" y="-340">
			<committed/>
		</location>
		<location id="id167" x="-314" y="-153">
			<committed/>
		</location>
		<location id="id168" x="-450" y="-238">
		</location>
		<location id="id169" x="-561" y="-238">
			<committed/>
		</location>
		<init ref="id165"/>
		<transition>
			<source ref="id164"/>
			<target ref="id165"/>
			<nail x="-153" y="-280"/>
			<nail x="-153" y="-416"/>
			<nail x="-671" y="-416"/>
		</transition>
		<transition>
			<source ref="id166"/>
			<target ref="id164"/>
			<label kind="synchronisation" x="-305" y="-314">Q_POS!</label>
		</transition>
		<transition>
			<source ref="id167"/>
			<target ref="id164"/>
			<label kind="synchronisation" x="-296" y="-221">Q_NEG!</label>
		</transition>
		<transition>
			<source ref="id168"/>
			<target ref="id167"/>
			<label kind="synchronisation" x="-476" y="-127">T_PHIL3_LOW?</label>
			<nail x="-433" y="-144"/>
		</transition>
		<transition>
			<source ref="id168"/>
			<target ref="id166"/>
			<label kind="synchronisation" x="-399" y="-246">T_PHIL3_MID?</label>
			<nail x="-348" y="-255"/>
		</transition>
		<transition>
			<source ref="id168"/>
			<target ref="id166"/>
			<label kind="synchronisation" x="-459" y="-323">T_PHIL3_HIGH?</label>
		</transition>
		<transition>
			<source ref="id169"/>
			<target ref="id168"/>
			<label kind="synchronisation" x="-552" y="-280">T_PHIL3_START!</label>
		</transition>
		<transition>
			<source ref="id165"/>
			<target ref="id169"/>
			<label kind="synchronisation" x="-653" y="-255">START?</label>
		</transition>
	</template>
	<template>
		<name>QBerlinQ</name>
		<parameter>broadcast chan &amp;START</parameter>
		<declaration>int tabl[2] = {300,460}; // FP, TP
int cost = 30;
int pos;
int get_P(){
    return tabl[has_osa];
}</declaration>
		<location id="id170" x="-76" y="34">
		</location>
		<location id="id171" x="-76" y="-59">
			<urgent/>
		</location>
		<location id="id172" x="-127" y="-204">
			<urgent/>
		</location>
		<location id="id173" x="-25" y="-204">
			<urgent/>
		</location>
		<branchpoint id="id174" x="-76" y="-119">
		</branchpoint>
		<init ref="id170"/>
		<transition>
			<source ref="id172"/>
			<target ref="id170"/>
			<label kind="synchronisation" x="-229" y="-221">Q_POS!</label>
			<nail x="-187" y="-204"/>
			<nail x="-187" y="34"/>
		</transition>
		<transition>
			<source ref="id173"/>
			<target ref="id170"/>
			<label kind="synchronisation" x="-7" y="-221">Q_NEG!</label>
			<nail x="93" y="-204"/>
			<nail x="93" y="34"/>
		</transition>
		<transition>
			<source ref="id174"/>
			<target ref="id173"/>
			<label kind="probability" x="-50" y="-144">1000-pos</label>
		</transition>
		<transition>
			<source ref="id174"/>
			<target ref="id172"/>
			<label kind="probability" x="-127" y="-144">pos</label>
		</transition>
		<transition>
			<source ref="id171"/>
			<target ref="id174"/>
		</transition>
		<transition>
			<source ref="id170"/>
			<target ref="id171"/>
			<label kind="synchronisation" x="-76" y="-29">START?</label>
			<label kind="assignment" x="-76" y="-12">pos = get_P(), TOTAL_COST = TOTAL_COST + cost</label>
		</transition>
	</template>
	<template>
		<name>QStopBang</name>
		<parameter>broadcast chan &amp;START</parameter>
		<declaration>const int sens = 880; //TRANS
const int spec = 420; //TRANS
int tabl[2] = {1000-spec, sens}; // FP, TP
int cost = 0;
int pos;
int get_P(){
    return tabl[has_osa];
}</declaration>
		<location id="id175" x="-76" y="34">
		</location>
		<location id="id176" x="-76" y="-59">
			<urgent/>
		</location>
		<location id="id177" x="-127" y="-204">
			<urgent/>
		</location>
		<location id="id178" x="-25" y="-204">
			<urgent/>
		</location>
		<branchpoint id="id179" x="-76" y="-119">
		</branchpoint>
		<init ref="id175"/>
		<transition>
			<source ref="id177"/>
			<target ref="id175"/>
			<label kind="synchronisation" x="-229" y="-221">Q_POS!</label>
			<nail x="-187" y="-204"/>
			<nail x="-187" y="34"/>
		</transition>
		<transition>
			<source ref="id178"/>
			<target ref="id175"/>
			<label kind="synchronisation" x="-7" y="-221">Q_NEG!</label>
			<nail x="93" y="-204"/>
			<nail x="93" y="34"/>
		</transition>
		<transition>
			<source ref="id179"/>
			<target ref="id178"/>
			<label kind="probability" x="-50" y="-144">1000-pos</label>
		</transition>
		<transition>
			<source ref="id179"/>
			<target ref="id177"/>
			<label kind="probability" x="-127" y="-144">pos</label>
		</transition>
		<transition>
			<source ref="id176"/>
			<target ref="id179"/>
		</transition>
		<transition>
			<source ref="id175"/>
			<target ref="id176"/>
			<label kind="synchronisation" x="-76" y="-29">START?</label>
			<label kind="assignment" x="-76" y="-12">pos = get_P(), TOTAL_COST = TOTAL_COST + cost</label>
		</transition>
	</template>
	<template>
		<name>QcomboODI</name>
		<parameter>broadcast chan &amp;START</parameter>
		<declaration>int cost = 120;
</declaration>
		<location id="id180" x="-76" y="34">
		</location>
		<location id="id181" x="-76" y="-42">
			<urgent/>
		</location>
		<location id="id182" x="-170" y="-170">
			<urgent/>
		</location>
		<location id="id183" x="-76" y="-170">
		</location>
		<location id="id184" x="-76" y="-382">
			<committed/>
		</location>
		<location id="id185" x="-76" y="-459">
			<committed/>
		</location>
		<init ref="id180"/>
		<transition>
			<source ref="id185"/>
			<target ref="id180"/>
			<nail x="221" y="-459"/>
			<nail x="229" y="68"/>
			<nail x="-51" y="68"/>
		</transition>
		<transition>
			<source ref="id184"/>
			<target ref="id185"/>
			<label kind="synchronisation" x="-76" y="-437">T_ODI_START!</label>
		</transition>
		<transition>
			<source ref="id183"/>
			<target ref="id184"/>
			<label kind="synchronisation" x="-8" y="-238">T_PHIL3_LOW?</label>
			<nail x="8" y="-289"/>
		</transition>
		<transition>
			<source ref="id183"/>
			<target ref="id184"/>
			<label kind="synchronisation" x="-178" y="-289">T_PHIL3_MID?</label>
		</transition>
		<transition>
			<source ref="id183"/>
			<target ref="id182"/>
			<label kind="synchronisation" x="-195" y="-195">T_PHIL3_HIGH?</label>
		</transition>
		<transition>
			<source ref="id182"/>
			<target ref="id180"/>
			<label kind="synchronisation" x="-178" y="-127">Q_POS!</label>
			<nail x="-187" y="-170"/>
			<nail x="-187" y="34"/>
		</transition>
		<transition>
			<source ref="id181"/>
			<target ref="id183"/>
			<label kind="synchronisation" x="-72" y="-135">T_PHIL3_START!</label>
		</transition>
		<transition>
			<source ref="id180"/>
			<target ref="id181"/>
			<label kind="synchronisation" x="-76" y="-29">START?</label>
			<label kind="assignment" x="-76" y="-12">TOTAL_COST = TOTAL_COST + cost</label>
		</transition>
	</template>
	<template>
		<name>QcomboNFLOW</name>
		<parameter>broadcast chan &amp;START</parameter>
		<declaration>int tabl[2] = {370,900}; // FP, TP
int cost = 120;
int pos;
int get_P(){
    return tabl[has_osa];
}</declaration>
		<location id="id186" x="-76" y="34">
		</location>
		<location id="id187" x="-76" y="-59">
			<urgent/>
		</location>
		<location id="id188" x="-127" y="-204">
			<urgent/>
		</location>
		<location id="id189" x="-25" y="-204">
			<urgent/>
		</location>
		<branchpoint id="id190" x="-76" y="-119">
		</branchpoint>
		<init ref="id186"/>
		<transition>
			<source ref="id188"/>
			<target ref="id186"/>
			<label kind="synchronisation" x="-229" y="-221">Q_POS!</label>
			<nail x="-187" y="-204"/>
			<nail x="-187" y="34"/>
		</transition>
		<transition>
			<source ref="id189"/>
			<target ref="id186"/>
			<label kind="synchronisation" x="-7" y="-221">Q_NEG!</label>
			<nail x="93" y="-204"/>
			<nail x="93" y="34"/>
		</transition>
		<transition>
			<source ref="id190"/>
			<target ref="id189"/>
			<label kind="probability" x="-50" y="-144">1000-pos</label>
		</transition>
		<transition>
			<source ref="id190"/>
			<target ref="id188"/>
			<label kind="probability" x="-127" y="-144">pos</label>
		</transition>
		<transition>
			<source ref="id187"/>
			<target ref="id190"/>
		</transition>
		<transition>
			<source ref="id186"/>
			<target ref="id187"/>
			<label kind="synchronisation" x="-76" y="-29">START?</label>
			<label kind="assignment" x="-76" y="-12">pos = get_P(), TOTAL_COST = TOTAL_COST + cost</label>
		</transition>
	</template>
	<template>
		<name>TreatmentCPAP</name>
		<location id="id191" x="0" y="0">
		</location>
		<location id="id192" x="246" y="0">
		</location>
		<location id="id193" x="365" y="93">
			<committed/>
		</location>
		<location id="id194" x="357" y="0">
			<committed/>
		</location>
		<location id="id195" x="357" y="-102">
			<committed/>
		</location>
		<location id="id196" x="118" y="0">
			<committed/>
		</location>
		<location id="id197" x="467" y="-102">
		</location>
		<location id="id198" x="467" y="0">
		</location>
		<location id="id199" x="467" y="93">
		</location>
		<init ref="id191"/>
		<transition>
			<source ref="id193"/>
			<target ref="id199"/>
			<label kind="synchronisation" x="365" y="59">TREATMENT_FAIL!</label>
		</transition>
		<transition>
			<source ref="id194"/>
			<target ref="id198"/>
			<label kind="synchronisation" x="374" y="-34">TREATMENT_NEG!</label>
		</transition>
		<transition>
			<source ref="id195"/>
			<target ref="id197"/>
			<label kind="synchronisation" x="374" y="-136">TREATMENT_POS!</label>
		</transition>
		<transition>
			<source ref="id192"/>
			<target ref="id193"/>
			<label kind="synchronisation" x="306" y="34">CPAP_FAIL?</label>
		</transition>
		<transition>
			<source ref="id192"/>
			<target ref="id194"/>
			<label kind="synchronisation" x="280" y="-34">CPAP_NEG?</label>
		</transition>
		<transition>
			<source ref="id192"/>
			<target ref="id195"/>
			<label kind="synchronisation" x="238" y="-85">CPAP_POS?</label>
			<label kind="assignment" x="195" y="-110">endOfTheLine=true</label>
		</transition>
		<transition>
			<source ref="id196"/>
			<target ref="id192"/>
			<label kind="synchronisation" x="153" y="-34">CPAP_WAIT!</label>
		</transition>
		<transition>
			<source ref="id191"/>
			<target ref="id196"/>
			<label kind="synchronisation" x="-17" y="-34">TREATMENT_START?</label>
		</transition>
	</template>
	<template>
		<name>TreatCpap</name>
		<declaration>clock c;
int cost = 350;
int MT = 21;
</declaration>
		<location id="id200" x="-790" y="-17">
			<name x="-800" y="-51">S</name>
		</location>
		<location id="id201" x="-374" y="136">
			<committed/>
		</location>
		<location id="id202" x="-374" y="-17">
			<committed/>
		</location>
		<location id="id203" x="-374" y="-170">
			<committed/>
		</location>
		<location id="id204" x="-264" y="136">
			<label kind="invariant" x="-274" y="153">c&lt;= 21</label>
		</location>
		<location id="id205" x="-128" y="136">
		</location>
		<location id="id206" x="-238" y="-170">
			<label kind="invariant" x="-248" y="-153">c&lt;=21</label>
		</location>
		<location id="id207" x="-128" y="-170">
			<name x="-138" y="-204">CPForever</name>
		</location>
		<location id="id208" x="-238" y="-17">
			<label kind="invariant" x="-263" y="0">c&lt;=77</label>
		</location>
		<location id="id209" x="-128" y="-17">
		</location>
		<location id="id210" x="-629" y="-17">
			<committed/>
		</location>
		<location id="id211" x="-595" y="-170">
			<committed/>
		</location>
		<location id="id212" x="-595" y="136">
			<committed/>
		</location>
		<branchpoint id="id213" x="-535" y="-170">
		</branchpoint>
		<branchpoint id="id214" x="-535" y="136">
		</branchpoint>
		<init ref="id200"/>
		<transition>
			<source ref="id210"/>
			<target ref="id212"/>
			<label kind="guard" x="-612" y="25">!has_osa</label>
		</transition>
		<transition>
			<source ref="id210"/>
			<target ref="id211"/>
			<label kind="guard" x="-603" y="-127">has_osa</label>
		</transition>
		<transition>
			<source ref="id214"/>
			<target ref="id201"/>
			<label kind="probability" x="-517" y="153">300</label>
		</transition>
		<transition>
			<source ref="id214"/>
			<target ref="id202"/>
			<label kind="probability" x="-484" y="93">700</label>
		</transition>
		<transition>
			<source ref="id214"/>
			<target ref="id203"/>
		</transition>
		<transition>
			<source ref="id211"/>
			<target ref="id213"/>
		</transition>
		<transition>
			<source ref="id200"/>
			<target ref="id210"/>
			<label kind="synchronisation" x="-756" y="-51">CPAP_START?</label>
			<label kind="assignment" x="-841" y="8">c := 0, TOTAL_COST = TOTAL_COST + cost</label>
		</transition>
		<transition>
			<source ref="id208"/>
			<target ref="id209"/>
			<label kind="guard" x="-204" y="-34">c&gt;=77</label>
			<label kind="synchronisation" x="-230" y="-51">CPAP_NEG!</label>
		</transition>
		<transition>
			<source ref="id202"/>
			<target ref="id208"/>
		</transition>
		<transition>
			<source ref="id206"/>
			<target ref="id207"/>
			<label kind="guard" x="-204" y="-204">c&gt;=21</label>
			<label kind="synchronisation" x="-220" y="-187">CPAP_POS!</label>
		</transition>
		<transition>
			<source ref="id203"/>
			<target ref="id206"/>
			<label kind="assignment" x="-374" y="-246">startFinalTreatment=true,
endOfTheLine=true,
gotCpapForever=true</label>
		</transition>
		<transition>
			<source ref="id204"/>
			<target ref="id205"/>
			<label kind="guard" x="-246" y="102">c &gt;= 21</label>
			<label kind="synchronisation" x="-220" y="119">CPAP_FAIL!</label>
		</transition>
		<transition>
			<source ref="id201"/>
			<target ref="id204"/>
		</transition>
		<transition>
			<source ref="id213"/>
			<target ref="id201"/>
			<label kind="probability" x="-535" y="-110">300</label>
		</transition>
		<transition>
			<source ref="id213"/>
			<target ref="id202"/>
		</transition>
		<transition>
			<source ref="id213"/>
			<target ref="id203"/>
			<label kind="probability" x="-527" y="-187">700</label>
		</transition>
		<transition>
			<source ref="id212"/>
			<target ref="id214"/>
		</transition>
	</template>
	<system>GP = GPbaseCase(); //TRANS

TM = TreatmentCPAP(); //TRANS
SC = SleepCentre(TREATMENT_START); //TRANS

// Waiting lists
SCW = Waiting(SC_WAIT, SC_START, 7, 14);
PSGW = Waiting(T_PSG_WAIT, T_PSG_START, 90, 120);
HSGW = Waiting(T_HSAT_WAIT, T_HSAT_START, 5,14);
TW = Waiting(TEST_WAIT, TEST_START, 0, 10);

CPAPW = Waiting(CPAP_WAIT, CPAP_START, 21, 30);

QW = Waiting(Q_WAIT, Q_START, 1, 7);

// Timers
DiagnosisTimer = Timer(diagnosed);
TreatmentTimer = Timer(startFinalTreatment);
CorrectDiagnosisTimer = Timer(corDig);
CorrectPositiveDiagnosisTimer = Timer(corPosDig);
EndOfTheLineTimer = Timer(endOfTheLine);
OtherTreatmentTimer = Timer(otherTreatment);
GotCpapForeverTimer = Timer(gotCpapForever);
// Tests
TPSG = TestPSG(T_PSG_START); 
TPG = TestHSAT(T_HSAT_START);
QTEM = QPhilLow(Q_START); //TRANS
TESTTEM = TestODI(TEST_START); //TRANS
OFDI = TestODI(T_ODI_START);
system Patient, GP, SC, SCW, QPhilips3, TPSG, PSGW, TESTTEM, TreatmentTimer, DiagnosisTimer, CorrectDiagnosisTimer, CorrectPositiveDiagnosisTimer, CPAPW, TreatCpap, TM, QW, QTEM,HSGW, TPG, TW,Anamnesis, EndOfTheLineTimer, OFDI, GotCpapForeverTimer;
</system>
	<queries>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( has_osa ) )
</formula>
			<comment>For the analysis software: what is the prevalence of OSA</comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] (&lt;&gt; ( Dhas_osa &amp;&amp; has_osa ))
</formula>
			<comment>true positive diagnoses</comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( has_osa &amp;&amp; Dno_osa ) )
</formula>
			<comment>false negative diagnoses</comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( no_osa &amp;&amp; Dno_osa ) )
</formula>
			<comment>true negative diagnoses</comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( no_osa &amp;&amp; Dhas_osa ) )
</formula>
			<comment>false positive diagnoses</comment>
		</query>
		<query>
			<formula>E[&lt;=50000; 70000] (max:TOTAL_COST)
</formula>
			<comment>Total cost of diagnosis</comment>
		</query>
		<query>
			<formula>E[&lt;=50000; 70000] (max:DiagnosisTimer.total)
</formula>
			<comment>Time to diagnosis</comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( TreatmentTimer.total&gt;0 ) )
</formula>
			<comment>Percentage of patients receiving treatment</comment>
		</query>
		<query>
			<formula>E[&lt;=50000; 70000] (max:TreatmentTimer.total)
</formula>
			<comment>Time to treatment</comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( CorrectDiagnosisTimer.total&gt;0 ) )
</formula>
			<comment>Percentage of patients receiving correct diagnosis</comment>
		</query>
		<query>
			<formula>E[&lt;=50000; 70000] (max:CorrectDiagnosisTimer.total)
</formula>
			<comment>Time to correct diagnosis</comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( CorrectPositiveDiagnosisTimer.total&gt;0 ) )
</formula>
			<comment>Percentage of patients receiving correct positive diagnosis</comment>
		</query>
		<query>
			<formula>E[&lt;=50000; 70000] (max:CorrectPositiveDiagnosisTimer.total)
</formula>
			<comment>Time to correct positive diagnosis</comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( GotCpapForeverTimer.total&gt;0 ) )
</formula>
			<comment></comment>
		</query>
		<query>
			<formula>E[&lt;=50000; 70000] (max:GotCpapForeverTimer.total)
</formula>
			<comment></comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( otherTreatment&gt;0 ) )
</formula>
			<comment></comment>
		</query>
		<query>
			<formula>Pr[&lt;=50000; 70000] ( &lt;&gt; ( startFinalTreatment&gt;0 ) )
</formula>
			<comment></comment>
		</query>
	</queries>
</nta>
